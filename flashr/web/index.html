<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashr Courses â€” Web & App</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0f14"/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0f14;--card:#111b2b;--accent:#66e3c4;--text:#fff;--muted:#aab}
    body{font-family:"Cairo",sans-serif;background:var(--bg);color:var(--text);margin:0}
    .container{max-width:1024px;margin:auto;padding:20px}
    .panel{background:var(--card);padding:20px;border-radius:14px;margin-top:18px;box-shadow:0 4px 20px #0003}
    input,button,select{font-family:inherit;font-size:16px}
    input{width:100%;padding:10px;border-radius:10px;border:none;margin:6px 0;background:#0d1625;color:#fff}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{padding:10px 14px;border:none;border-radius:10px;cursor:pointer}
    .primary{background:var(--accent);color:#000;font-weight:700}
    .ghost{background:#1b2740;color:#fff}
    .muted{color:var(--muted);margin-top:8px}
    .tabs{display:flex;gap:8px;margin:8px 0}
    .tab{padding:8px 12px;border-radius:999px;background:#0d1625;cursor:pointer}
    .tab.active{background:var(--accent);color:#000;font-weight:700}
    ul{margin:0;padding-inline-start:18px}
    .badge{background:#0d1625;padding:4px 8px;border-radius:999px;margin-inline-start:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .divider{height:1px;background:#23314f;margin:14px 0}
  </style>
  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ“š Flashr â€” Ø§Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</h1>

    <div id="auth" class="panel">
      <div class="tabs">
        <div class="tab active" id="tabEmail">Ø¥ÙŠÙ…ÙŠÙ„</div>
        <div class="tab" id="tabPhone">Ù…ÙˆØ¨Ø§ÙŠÙ„</div>
      </div>

      <div id="emailBox">
        <div class="row">
          <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
          <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <div class="row">
          <button id="loginBtn"  class="btn primary">Ø¯Ø®ÙˆÙ„</button>
          <button id="signupBtn" class="btn ghost">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <button id="resetBtn" class="btn ghost" style="margin-top:8px">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
      </div>

      <div id="phoneBox" style="display:none">
        <div class="row">
          <input id="phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ù…Ø«Ø§Ù„: +2010xxxxxxx)">
          <button id="sendOtpBtn" class="btn primary">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯</button>
        </div>
        <div id="recaptcha-container"></div>
        <div class="row">
          <input id="otp" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯">
          <button id="verifyOtpBtn" class="btn ghost">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
        </div>
      </div>

      <div id="authMsg" class="muted"></div>
    </div>

    <div id="app" style="display:none" class="panel">
      <div class="grid">
        <div>
          <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ <span id="userEmail"></span></h2>
          <button id="logoutBtn" class="btn ghost">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
          <div class="muted" id="uidBox"></div>
        </div>
        <div>
          <button id="certBtn" class="btn primary">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
        </div>
      </div>

      <div class="divider"></div>
      <h3>Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h3>
      <ul id="coursesList"></ul>

      <div id="devPanel" class="panel" style="display:none">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± <span class="badge">Ø®Ø§Øµ Ø¨Ù€ yassenhassouna39@gmail.com</span></h3>
        <div class="row">
          <input id="courseName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³">
          <button id="addCourseBtn" class="btn primary">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³</button>
        </div>
        <div class="divider"></div>
        <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ø¬Ø¯Ø¯</h4>
        <ul id="usersList"></ul>
      </div>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD6pxL1-0VpUm36wmK6uMHAPSHNFmOZitk",
  authDomain: "flash-card-yan.firebaseapp.com",
  projectId: "flash-card-yan",
  storageBucket: "flash-card-yan.firebasestorage.app",
  messagingSenderId: "835062893775",
  appId: "1:835062893775:web:7b0347f047f1c88e513bba",
  measurementId: "G-FGX8WYD775"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();
try { firebase.analytics(); } catch(e){}

const devEmail = "yassenhassouna39@gmail.com";
function $(id){ return document.getElementById(id); }
function tErr(code){
  const map = {
    "auth/user-not-found":"Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.",
    "auth/wrong-password":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.",
    "auth/email-already-in-use":"Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.",
    "auth/invalid-email":"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­.",
    "auth/weak-password":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ù‹Ø§.",
    "auth/too-many-requests":"Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§.",
    "auth/invalid-verification-code":"Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.",
    "auth/invalid-verification-id":"Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„."
  };
  return map[code] || ("Ø­Ø¯Ø« Ø®Ø·Ø£: "+code);
}

// Tabs
$("tabEmail").onclick = ()=>{
  $("tabEmail").classList.add("active");
  $("tabPhone").classList.remove("active");
  $("emailBox").style.display="block";
  $("phoneBox").style.display="none";
  $("authMsg").textContent="";
};
$("tabPhone").onclick = ()=>{
  $("tabPhone").classList.add("active");
  $("tabEmail").classList.remove("active");
  $("emailBox").style.display="none";
  $("phoneBox").style.display="block";
  $("authMsg").textContent="";
};

// Email/Password
$("loginBtn").onclick = async ()=>{
  try{
    await auth.signInWithEmailAndPassword($("email").value, $("password").value);
    $("authMsg").textContent = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
  }catch(e){ $("authMsg").textContent = tErr(e.code); }
};
$("signupBtn").onclick = async ()=>{
  try{
    const cred = await auth.createUserWithEmailAndPassword($("email").value, $("password").value);
    $("authMsg").textContent = "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰";
    await db.collection("users").doc(cred.user.uid).set({
      uid: cred.user.uid,
      email: cred.user.email || null,
      phone: cred.user.phoneNumber || null,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge:true });
  }catch(e){ $("authMsg").textContent = tErr(e.code); }
};
$("resetBtn").onclick = async ()=>{
  try{
    await auth.sendPasswordResetEmail($("email").value);
    $("authMsg").textContent = "ğŸ“© ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø¨Ø±ÙŠØ¯Ùƒ.";
  }catch(e){ $("authMsg").textContent = tErr(e.code); }
};

// Phone sign-in
let confirmationResult = null;
function setupRecaptcha(){
  if(window._recaptchaReady) return;
  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
  window._recaptchaReady = true;
}
$("sendOtpBtn").onclick = async ()=>{
  try{
    setupRecaptcha();
    confirmationResult = await auth.signInWithPhoneNumber($("phone").value, window.recaptchaVerifier);
    $("authMsg").textContent = "ğŸ“² ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯. Ø§ÙØ­Øµ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.";
  }catch(e){
    $("authMsg").textContent = tErr(e.code);
  }
};
$("verifyOtpBtn").onclick = async ()=>{
  try{
    if(!confirmationResult){ $("authMsg").textContent="Ø£Ø±Ø³Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ù‹Ø§."; return; }
    const cred = await confirmationResult.confirm($("otp").value);
    $("authMsg").textContent = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ âœ…";
    await db.collection("users").doc(cred.user.uid).set({
      uid: cred.user.uid,
      email: cred.user.email || null,
      phone: cred.user.phoneNumber || null,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge:true });
  }catch(e){
    $("authMsg").textContent = tErr(e.code);
  }
};

// State
auth.onAuthStateChanged(async (user)=>{
  if(user){
    $("auth").style.display="none";
    $("app").style.display="block";
    $("userEmail").textContent = user.email || user.phoneNumber || "";
    $("uidBox").textContent = "UID: " + user.uid;
    await db.collection("users").doc(user.uid).set({
      uid: user.uid,
      email: user.email || null,
      phone: user.phoneNumber || null,
      lastLogin: firebase.firestore.FieldValue.serverTimestamp()
    }, { merge:true });

    try{
      const snap = await db.collection("courses").orderBy("name").get();
      $("coursesList").innerHTML = "";
      if(snap.empty){
        const li = document.createElement('li');
        li.textContent = "Ù…Ø§ÙÙŠØ´ ÙƒÙˆØ±Ø³Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø³ØªØ®Ø¯Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³.";
        $("coursesList").appendChild(li);
      } else {
        snap.forEach(doc=>{
          const li = document.createElement('li');
          li.textContent = doc.data().name;
          $("coursesList").appendChild(li);
        });
      }
    }catch(e){}

    if((user.email||"").toLowerCase() === devEmail){
      $("devPanel").style.display="block";
      const us = await db.collection("users").orderBy("createdAt","desc").limit(50).get();
      $("usersList").innerHTML="";
      us.forEach(d=>{
        const u = d.data();
        const li = document.createElement('li');
        li.textContent = (u.email||u.phone||"") + " â€” " + (u.createdAt?.toDate ? u.createdAt.toDate().toLocaleString() : "");
        $("usersList").appendChild(li);
      });
    }

  }else{
    $("auth").style.display="block";
    $("app").style.display="none";
  }
});

$("logoutBtn").onclick = ()=>{ auth.signOut(); $("authMsg").textContent="ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬."; };

$("certBtn").onclick = ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const user = auth.currentUser;
  doc.text("Ø´Ù‡Ø§Ø¯Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„ÙƒÙˆØ±Ø³", 20, 20);
  doc.text("Ø§Ù„Ø·Ø§Ù„Ø¨: " + (user?.email || user?.phoneNumber || ""), 20, 40);
  doc.save("certificate.pdf");
};
</script>
</body>
</html>
